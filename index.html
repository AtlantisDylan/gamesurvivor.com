<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />

  <title>萝卜纸巾情侣版｜3次辨妆小游戏（男友挑战）- GameSurvivors</title>
  <meta name="description" content="致敬爆火的“萝卜纸巾猫”辨物梗：在《萝卜纸巾情侣版》中你扮演男生，3次机会从两款相似化妆品中选出女朋友要的那一个。答对亲吻奖励，答错榴莲惩罚，最终用1-3颗红心结算默契值。" />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="canonical" href="https://gamesurvivors.com/luobo-zhijin-couple" />
  <meta name="theme-color" content="#0A84FF" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            appleBg: "#F5F5F7",
            appleCard: "#FFFFFF",
            appleText: "#1D1D1F",
            appleSub: "#6E6E73",
            appleBlue: "#0A84FF",
            appleGreen: "#34C759",
            appleRed: "#FF3B30",
            appleGray: "#E5E5EA"
          },
          boxShadow: {
            apple: "0 10px 30px rgba(0,0,0,0.08)"
          }
        }
      }
    }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"萝卜纸巾情侣版（暂定）",
    "url":"https://gamesurvivors.com/luobo-zhijin-couple",
    "applicationCategory":"GameApplication",
    "operatingSystem":"Web",
    "description":"情侣版辨物小游戏：男友根据女友提示区分相似化妆品，3次机会，亲吻奖励与榴莲惩罚，红心结算默契值。"
  }
  </script>

  <style>
    .tap-scale { transform: translateZ(0); }
    .tap-scale:active { transform: scale(0.98); }
    .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
    .no-select { -webkit-user-select:none; user-select:none; }
  </style>
</head>

<body class="bg-appleBg text-appleText safe-pb">
  <header class="max-w-3xl mx-auto px-4 sm:px-6 pt-10 pb-6">
    <!-- 仅 1 个 H1 -->
    <h1 class="text-2xl sm:text-4xl font-semibold tracking-tight">
      萝卜纸巾情侣版（暂定）：男友辨妆 3 连挑
    </h1>
    <p class="mt-3 text-appleSub leading-relaxed max-w-2xl">
      灵感来自“萝卜纸巾猫”辨物梗：你只有 3 次机会，从两款相似化妆品中选出女朋友要的那一个。
    </p>
  </header>

  <main class="max-w-3xl mx-auto px-4 sm:px-6 pb-12">
    <!-- ========== A) 初始页面 ========== -->
    <section id="viewHome" class="rounded-2xl bg-appleCard shadow-apple border border-appleGray p-5 sm:p-6">
      <h2 class="text-lg sm:text-xl font-semibold">开始前</h2>
      <p class="mt-2 text-appleSub leading-relaxed">
        点击开始，进入 3 道题挑战。答对亲吻奖励，答错榴莲惩罚，最后用红心结算默契值。
      </p>

      <div class="mt-5 grid grid-cols-1 sm:grid-cols-3 gap-3">
        <button id="btnGoGame" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-3 bg-appleBlue text-white font-medium shadow-apple hover:opacity-95 transition">
          开始游戏
        </button>

        <button id="btnGoRules" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-3 bg-white border border-appleGray text-appleText font-medium hover:shadow-apple transition">
          查看细致规则
        </button>

        <button id="btnGoScore" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-3 bg-white border border-appleGray text-appleText font-medium hover:shadow-apple transition">
          最近积分
        </button>
      </div>

      <div class="mt-6 rounded-xl border border-appleGray bg-white p-4">
        <div class="text-sm text-appleSub">小提示</div>
        <div class="mt-1 font-medium">题目会刻意选择“名字相近 / 外观相似 / 使用方式接近”的组合。</div>
      </div>
    </section>

    <!-- ========== 查看细致规则（单独页） ========== -->
    <section id="viewRules" class="hidden mt-6 rounded-2xl bg-appleCard shadow-apple border border-appleGray p-5 sm:p-6">
      <div class="flex items-start justify-between gap-3">
        <h2 class="text-lg sm:text-xl font-semibold">细致规则</h2>
        <button id="btnRulesBack" class="tap-scale rounded-xl px-3 py-2 bg-white border border-appleGray text-sm font-medium hover:shadow-apple transition">
          返回
        </button>
      </div>

      <ul class="mt-4 space-y-2 text-appleSub leading-relaxed">
        <li>你扮演男生：每题根据女朋友的需求提示，从两款相似化妆品中二选一。</li>
        <li>每局共 3 题；同一局内题目不重复。</li>
        <li>作答前：只显示选项名称，不显示任何“特性说明”。</li>
        <li>作答后：立即显示“当前反馈”，公布正确答案，并展示两款产品的差异说明（帮助玩家学习）。</li>
        <li>结算：以 1-3 颗红心代表答对题数（0题将显示💔）。</li>
      </ul>
    </section>

    <!-- ========== 最近积分（单独页） ========== -->
    <section id="viewScore" class="hidden mt-6 rounded-2xl bg-appleCard shadow-apple border border-appleGray p-5 sm:p-6">
      <div class="flex items-start justify-between gap-3">
        <h2 class="text-lg sm:text-xl font-semibold">最近积分</h2>
        <button id="btnScoreBack" class="tap-scale rounded-xl px-3 py-2 bg-white border border-appleGray text-sm font-medium hover:shadow-apple transition">
          返回
        </button>
      </div>

      <p class="mt-3 text-appleSub leading-relaxed">
        本地记录最近 5 局（仅保存在你的浏览器中）。
      </p>

      <div class="mt-4 rounded-xl border border-appleGray bg-white p-4">
        <div class="flex items-center justify-between gap-3">
          <div class="text-sm text-appleSub">记录列表</div>
          <button id="btnClearHistory" class="tap-scale rounded-xl px-3 py-2 bg-white border border-appleGray text-sm font-medium hover:shadow-apple transition">
            清空记录
          </button>
        </div>

        <div id="historyList" class="mt-3 space-y-3"></div>
        <div id="historyEmpty" class="mt-3 text-sm text-appleSub hidden">暂无记录。先来一局吧。</div>
      </div>
    </section>

    <!-- ========== B) 游戏页：3道题 ========== -->
    <section id="viewGame" class="hidden mt-6 rounded-2xl bg-appleCard shadow-apple border border-appleGray p-5 sm:p-6">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <h2 class="text-lg sm:text-xl font-semibold">挑战进行中：第 <span id="roundNum">1</span> / 3 题</h2>

        <div class="flex items-center gap-2 text-sm text-appleSub">
          <span class="inline-flex items-center justify-center w-8 h-8 rounded-xl bg-white border border-appleGray" title="正确数">✓</span>
          <span id="scoreBadge" class="font-medium">0</span>
        </div>
      </div>

      <p id="prompt" class="mt-2 text-appleSub leading-relaxed">
        —
      </p>

      <div class="mt-5 grid grid-cols-1 sm:grid-cols-2 gap-4">
        <button id="optA" class="tap-scale no-select text-left rounded-2xl border border-appleGray bg-white p-5 hover:shadow-apple transition disabled:opacity-50 disabled:cursor-not-allowed">
          <div class="text-sm text-appleSub">选项 A</div>
          <div id="optATitle" class="mt-1 text-lg font-semibold">-</div>
          <!-- 作答前不显示说明；作答后才显示 -->
          <div id="optADesc" class="mt-3 text-sm text-appleSub leading-relaxed hidden">-</div>
        </button>

        <button id="optB" class="tap-scale no-select text-left rounded-2xl border border-appleGray bg-white p-5 hover:shadow-apple transition disabled:opacity-50 disabled:cursor-not-allowed">
          <div class="text-sm text-appleSub">选项 B</div>
          <div id="optBTitle" class="mt-1 text-lg font-semibold">-</div>
          <div id="optBDesc" class="mt-3 text-sm text-appleSub leading-relaxed hidden">-</div>
        </button>
      </div>

      <!-- 作答后立即显示反馈（你提到的“当前反馈模块”） -->
      <div id="feedbackCard" class="hidden mt-5 rounded-xl border border-appleGray bg-white p-4">
        <div class="text-sm text-appleSub">当前反馈</div>
        <div id="feedback" class="mt-2 text-base font-semibold">-</div>
        <div id="rewardLine" class="mt-2 text-2xl" aria-live="polite"></div>
        <div class="mt-3 flex flex-wrap gap-3">
          <button id="btnNext" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-2 bg-appleGreen text-white font-medium shadow-apple hover:opacity-95 transition disabled:opacity-50 disabled:cursor-not-allowed">
            下一题
          </button>
          <button id="btnQuitToHome" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-2 bg-white border border-appleGray text-appleText font-medium hover:shadow-apple transition">
            退出到首页
          </button>
        </div>
      </div>
    </section>

    <!-- ========== C) 结算结果页 ========== -->
    <section id="viewResult" class="hidden mt-6 rounded-2xl bg-appleCard shadow-apple border border-appleGray p-5 sm:p-6">
      <h2 class="text-lg sm:text-xl font-semibold">结算结果</h2>
      <p class="mt-2 text-appleSub leading-relaxed">
        你本局答对 <span id="finalScoreInline" class="font-semibold text-appleText">0</span> 题，红心代表默契值。
      </p>

      <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="rounded-2xl border border-appleGray bg-white p-5">
          <div class="text-sm text-appleSub">红心</div>
          <div id="hearts" class="mt-2 text-3xl" aria-live="polite">—</div>
        </div>
        <div class="rounded-2xl border border-appleGray bg-white p-5">
          <div class="text-sm text-appleSub">正确题数</div>
          <div id="finalScore" class="mt-2 text-2xl font-semibold">—</div>
        </div>
        <div class="rounded-2xl border border-appleGray bg-white p-5">
          <div class="text-sm text-appleSub">评价</div>
          <div id="finalComment" class="mt-2 text-base font-semibold">—</div>
        </div>
      </div>

      <div class="mt-5 flex flex-wrap gap-3">
        <button id="btnPlayAgain" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-2 bg-appleBlue text-white font-medium shadow-apple hover:opacity-95 transition">
          再来一局
        </button>
        <button id="btnResultToHome" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-2 bg-white border border-appleGray text-appleText font-medium hover:shadow-apple transition">
          回到首页
        </button>
        <button id="btnResultToScore" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-2 bg-white border border-appleGray text-appleText font-medium hover:shadow-apple transition">
          查看最近积分
        </button>
      </div>
    </section>

    <footer class="mt-10 text-center text-sm text-appleSub">
      <h2 class="sr-only">页脚</h2>
      <p>© <span id="year"></span> GameSurvivors.com · 萝卜纸巾情侣版（暂定）</p>
    </footer>
  </main>

  <script>
    // =============================
    // 题库：每一题为“两选一”相似化妆品，包含提示与正确答案
    // 注意：作答前不展示desc；作答后才展示
    // =============================
    const PAIRS = [
      {
        id: "lipstick-vs-lipbalm",
        prompt: "她说：『我要的是“有颜色、显气色、出门一抹就行”的那支。』你选？",
        a: { name: "润唇膏", desc: "主打滋润修护，通常更偏“护唇”，颜色较淡或无色。" },
        b: { name: "口红", desc: "显色更强，强调妆效与气色，持妆需求更高。" },
        correct: "口红"
      },
      {
        id: "lipgloss-vs-lip-oil",
        prompt: "她说：『我要那种“水亮、镜面感、像玻璃唇”的。』你选？",
        a: { name: "唇蜜（Lip Gloss）", desc: "更强调镜面光泽与成膜质感，妆效明显。" },
        b: { name: "唇油（Lip Oil）", desc: "更偏滋润养护与轻薄光泽，常更像护唇+微光。" },
        correct: "唇蜜（Lip Gloss）"
      },
      {
        id: "foundation-vs-bb",
        prompt: "她说：『今天要“遮瑕更稳、妆面更正式”的底妆。』你选？",
        a: { name: "粉底液", desc: "遮瑕与妆效选择更丰富，适合打造完整底妆。" },
        b: { name: "BB霜", desc: "更偏日常快速，遮瑕通常较轻薄。" },
        correct: "粉底液"
      },
      {
        id: "concealer-vs-corrector",
        prompt: "她说：『黑眼圈有点重，我要“遮掉瑕疵”的那支。』你选？",
        a: { name: "遮瑕膏", desc: "用于遮盖黑眼圈、痘印等局部瑕疵，通常更高遮盖。" },
        b: { name: "校色膏", desc: "用于中和肤色问题（泛红/暗沉），更偏颜色修正。" },
        correct: "遮瑕膏"
      },
      {
        id: "blush-vs-bronzer",
        prompt: "她说：『我想要“脸颊看起来更有血色”的。』你选？",
        a: { name: "腮红", desc: "增加气色与红润感，通常刷在苹果肌/颧骨附近。" },
        b: { name: "修容（阴影）", desc: "强调轮廓与阴影，通常用于削弱或修饰面部线条。" },
        correct: "腮红"
      },
      {
        id: "highlighter-vs-glow-primer",
        prompt: "她说：『我想要“局部提亮、鼻梁和颧骨会闪”的那种。』你选？",
        a: { name: "高光", desc: "用于局部提亮，妆效集中，闪度更明显。" },
        b: { name: "妆前乳（珠光）", desc: "更偏整体打底提亮，妆感更均匀、低调。" },
        correct: "高光"
      },
      {
        id: "eyebrow-pencil-vs-brow-powder",
        prompt: "她说：『我想画“根根分明、线条更清晰”的眉毛。』你选？",
        a: { name: "眉笔", desc: "线条感更强，适合补眉形与刻画细节。" },
        b: { name: "眉粉", desc: "更柔和雾面，适合大面积填色与自然过渡。" },
        correct: "眉笔"
      },
      {
        id: "eyeliner-pen-vs-eyeliner-gel",
        prompt: "她说：『我要“更持久、防晕、适合内眼线”的那种。』你选？",
        a: { name: "眼线液笔", desc: "出线利落，适合拉长眼尾，但内眼线可能更考验技术。" },
        b: { name: "眼线胶笔", desc: "更贴合、相对更耐磨，很多人用来画内眼线。" },
        correct: "眼线胶笔"
      },
      {
        id: "setting-spray-vs-setting-powder",
        prompt: "她说：『我脸有点油光，想要“立刻变哑光、控油”的。』你选？",
        a: { name: "定妆喷雾", desc: "更偏提升成膜与服帖度，妆效看配方。" },
        b: { name: "定妆粉", desc: "更直接压油光、柔焦毛孔，快速哑光。" },
        correct: "定妆粉"
      },
      {
        id: "mascara-vs-lash-primer",
        prompt: "她说：『我要“刷上就变长变浓、眼睛更有神”的那支。』你选？",
        a: { name: "睫毛膏", desc: "主打纤长/浓密/卷翘，能直接产生明显妆效。" },
        b: { name: "睫毛打底", desc: "用于打底增强后续睫毛膏效果，本身妆效通常较弱。" },
        correct: "睫毛膏"
      }
    ];

    // =============================
    // 轻量工具
    // =============================
    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

    // =============================
    // 本地“最近积分”存储
    // =============================
    const HISTORY_KEY = "gs_luobo_zhijin_couple_history_v1";
    function loadHistory() {
      try { return JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]"); }
      catch { return []; }
    }
    function saveHistory(list) {
      localStorage.setItem(HISTORY_KEY, JSON.stringify(list));
    }
    function pushHistory(entry) {
      const list = loadHistory();
      list.unshift(entry);
      // 仅保留最近5条
      const trimmed = list.slice(0, 5);
      saveHistory(trimmed);
    }

    // =============================
    // 视图切换
    // =============================
    const viewHome   = document.getElementById("viewHome");
    const viewRules  = document.getElementById("viewRules");
    const viewScore  = document.getElementById("viewScore");
    const viewGame   = document.getElementById("viewGame");
    const viewResult = document.getElementById("viewResult");

    function showOnly(view) {
      [viewHome, viewRules, viewScore, viewGame, viewResult].forEach(v => v.classList.add("hidden"));
      view.classList.remove("hidden");
      // 让移动端在切换时更顺滑
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // =============================
    // DOM：游戏
    // =============================
    const roundNum = document.getElementById("roundNum");
    const scoreBadge = document.getElementById("scoreBadge");
    const promptEl = document.getElementById("prompt");

    const optA = document.getElementById("optA");
    const optB = document.getElementById("optB");
    const optATitle = document.getElementById("optATitle");
    const optBTitle = document.getElementById("optBTitle");
    const optADesc = document.getElementById("optADesc");
    const optBDesc = document.getElementById("optBDesc");

    const feedbackCard = document.getElementById("feedbackCard");
    const feedback = document.getElementById("feedback");
    const rewardLine = document.getElementById("rewardLine");
    const btnNext = document.getElementById("btnNext");

    // =============================
    // DOM：结算
    // =============================
    const heartsEl = document.getElementById("hearts");
    const finalScoreEl = document.getElementById("finalScore");
    const finalScoreInline = document.getElementById("finalScoreInline");
    const finalCommentEl = document.getElementById("finalComment");

    // =============================
    // DOM：最近积分
    // =============================
    const historyList = document.getElementById("historyList");
    const historyEmpty = document.getElementById("historyEmpty");

    // =============================
    // 状态
    // =============================
    let gameActive = false;
    let roundIndex = 0; // 0..2
    let score = 0;
    let questions = [];
    let answered = false;
    let currentQ = null;
    let currentLayout = null; // {A:{name,desc}, B:{name,desc}, correctName}

    // =============================
    // UI：样式提示
    // =============================
    function setOptionBorder(state) {
      // state: "neutral" | "correctA" | "correctB" | "wrongA" | "wrongB"
      // 先清理
      [optA, optB].forEach(btn => {
        btn.classList.remove("border-appleGreen","border-appleRed","ring-2","ring-appleGreen","ring-appleRed");
        btn.classList.add("border-appleGray");
      });

      if (state === "correctA") {
        optA.classList.remove("border-appleGray");
        optA.classList.add("border-appleGreen","ring-2","ring-appleGreen");
      }
      if (state === "correctB") {
        optB.classList.remove("border-appleGray");
        optB.classList.add("border-appleGreen","ring-2","ring-appleGreen");
      }
      if (state === "wrongA") {
        optA.classList.remove("border-appleGray");
        optA.classList.add("border-appleRed","ring-2","ring-appleRed");
      }
      if (state === "wrongB") {
        optB.classList.remove("border-appleGray");
        optB.classList.add("border-appleRed","ring-2","ring-appleRed");
      }
    }

    function setChoicesEnabled(enabled) {
      optA.disabled = !enabled;
      optB.disabled = !enabled;
    }

    function hideDescs() {
      optADesc.classList.add("hidden");
      optBDesc.classList.add("hidden");
    }

    function showDescs(aDesc, bDesc) {
      optADesc.textContent = aDesc;
      optBDesc.textContent = bDesc;
      optADesc.classList.remove("hidden");
      optBDesc.classList.remove("hidden");
    }

    function updateHUD() {
      roundNum.textContent = String(roundIndex + 1);
      scoreBadge.textContent = String(score);
    }

    // =============================
    // 游戏：开始/出题/作答/结算
    // =============================
    function startGame() {
      questions = shuffle(PAIRS).slice(0, 3);
      roundIndex = 0;
      score = 0;
      answered = false;
      gameActive = true;

      feedbackCard.classList.add("hidden");
      rewardLine.textContent = "";
      setOptionBorder("neutral");
      hideDescs();

      showOnly(viewGame);
      loadRound();
    }

    function loadRound() {
      currentQ = questions[roundIndex];
      answered = false;
      updateHUD();

      promptEl.textContent = currentQ.prompt;

      // 洗牌放置A/B（仅显示名称，不显示desc）
      const variants = shuffle([
        { name: currentQ.a.name, desc: currentQ.a.desc },
        { name: currentQ.b.name, desc: currentQ.b.desc }
      ]);

      currentLayout = {
        A: variants[0],
        B: variants[1],
        correctName: currentQ.correct
      };

      optATitle.textContent = currentLayout.A.name;
      optBTitle.textContent = currentLayout.B.name;

      // 作答前：不展示说明
      hideDescs();

      // 反馈模块隐藏
      feedbackCard.classList.add("hidden");
      btnNext.disabled = true;

      // 选项可点击
      setChoicesEnabled(true);
      setOptionBorder("neutral");
    }

    function answer(choiceKey) {
      if (!gameActive || answered) return;
      answered = true;

      setChoicesEnabled(false);

      const chosenName = currentLayout[choiceKey].name;
      const correctName = currentLayout.correctName;

      const isCorrect = chosenName === correctName;

      // 作答后：展示两边说明（符合你第1条需求）
      showDescs(currentLayout.A.desc, currentLayout.B.desc);

      // 反馈模块立即显示（符合你第2条 b）
      feedbackCard.classList.remove("hidden");

      if (isCorrect) {
        score += 1;
        feedback.textContent = `答对了：她要的是「${correctName}」。`;
        rewardLine.textContent = "💋💋💋（亲吻奖励）";
        setOptionBorder(choiceKey === "A" ? "correctA" : "correctB");
      } else {
        feedback.textContent = `答错了：她要的是「${correctName}」，你给了「${chosenName}」。`;
        rewardLine.textContent = "🫣🍈（榴莲惩罚）";
        setOptionBorder(choiceKey === "A" ? "wrongA" : "wrongB");

        // 再标出正确项
        const correctKey = (currentLayout.A.name === correctName) ? "A" : "B";
        setTimeout(() => {
          setOptionBorder(correctKey === "A" ? "correctA" : "correctB");
        }, 250);
      }

      updateHUD();

      // 最后一题：不显示“下一题”，而是直接引导结算
      if (roundIndex === 2) {
        btnNext.textContent = "查看结算结果";
        btnNext.disabled = false;
      } else {
        btnNext.textContent = "下一题";
        btnNext.disabled = false;
      }
    }

    function nextStep() {
      if (!answered) return;

      if (roundIndex === 2) {
        endGame();
        return;
      }

      roundIndex += 1;
      loadRound();
    }

    function endGame() {
      gameActive = false;

      // 写入历史
      pushHistory({
        ts: Date.now(),
        score,
        total: 3
      });

      // 结算渲染
      renderResult();
      showOnly(viewResult);
    }

    function renderResult() {
      const s = clamp(score, 0, 3);
      const hearts = s === 0 ? "💔" : "❤️".repeat(s);

      heartsEl.textContent = hearts;
      finalScoreInline.textContent = String(s);
      finalScoreEl.textContent = `${s} / 3`;

      let comment = "需要加强学习：建议先记住她常用的那几样。";
      if (s === 1) comment = "勉强过关：下一次，别让榴莲太嚣张。";
      if (s === 2) comment = "不错：已经接近“心有灵犀”。";
      if (s === 3) comment = "满分默契：今晚你是“懂妆王”。";
      finalCommentEl.textContent = comment;
    }

    // =============================
    // 最近积分：渲染
    // =============================
    function formatTime(ts) {
      const d = new Date(ts);
      const pad = (n) => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    function renderHistory() {
      const list = loadHistory();
      historyList.innerHTML = "";

      if (!list.length) {
        historyEmpty.classList.remove("hidden");
        return;
      }
      historyEmpty.classList.add("hidden");

      list.forEach(item => {
        const s = clamp(item.score, 0, 3);
        const hearts = s === 0 ? "💔" : "❤️".repeat(s);

        const card = document.createElement("div");
        card.className = "rounded-xl border border-appleGray bg-appleBg p-4";
        card.innerHTML = `
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="text-sm text-appleSub">时间</div>
              <div class="mt-1 font-medium">${formatTime(item.ts)}</div>
            </div>
            <div class="text-right">
              <div class="text-sm text-appleSub">成绩</div>
              <div class="mt-1 text-lg font-semibold">${s}/3</div>
            </div>
          </div>
          <div class="mt-2 text-2xl">${hearts}</div>
        `;
        historyList.appendChild(card);
      });
    }

    // =============================
    // 导航按钮绑定
    // =============================
    document.getElementById("year").textContent = new Date().getFullYear();

    // 首页三按钮
    document.getElementById("btnGoGame").addEventListener("click", startGame);
    document.getElementById("btnGoRules").addEventListener("click", () => showOnly(viewRules));
    document.getElementById("btnGoScore").addEventListener("click", () => { renderHistory(); showOnly(viewScore); });

    // 规则页返回
    document.getElementById("btnRulesBack").addEventListener("click", () => showOnly(viewHome));

    // 积分页返回 + 清空
    document.getElementById("btnScoreBack").addEventListener("click", () => showOnly(viewHome));
    document.getElementById("btnClearHistory").addEventListener("click", () => {
      localStorage.removeItem(HISTORY_KEY);
      renderHistory();
    });

    // 游戏页：作答 / 下一步 / 退出
    optA.addEventListener("click", () => answer("A"));
    optB.addEventListener("click", () => answer("B"));
    btnNext.addEventListener("click", nextStep);
    document.getElementById("btnQuitToHome").addEventListener("click", () => showOnly(viewHome));

    // 结算页：再来一局 / 回首页 / 看积分
    document.getElementById("btnPlayAgain").addEventListener("click", startGame);
    document.getElementById("btnResultToHome").addEventListener("click", () => showOnly(viewHome));
    document.getElementById("btnResultToScore").addEventListener("click", () => { renderHistory(); showOnly(viewScore); });

    // 初始：只显示首页
    showOnly(viewHome);
  </script>
</body>
</html>
