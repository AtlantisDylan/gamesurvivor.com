<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />

  <title>萝卜纸巾猫情侣版｜但男友是那只猫- GameSurvivors</title>
  <meta name="description" content="《萝卜纸巾猫》情侣版上线~~快发给男友让他帮你选化妆品吧！3次机会，答对亲吻奖励，答错榴莲惩罚，看你能得芳心几许？" />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="canonical" href="https://gamesurvivors.com/luobo-zhijin-couple" />
  <meta name="theme-color" content="#0A84FF" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            appleBg: "#F5F5F7",
            appleCard: "#FFFFFF",
            appleText: "#1D1D1F",
            appleSub: "#6E6E73",
            appleBlue: "#0A84FF",
            appleGreen: "#34C759",
            appleRed: "#FF3B30",
            appleGray: "#E5E5EA"
          },
          boxShadow: {
            apple: "0 10px 30px rgba(0,0,0,0.08)"
          }
        }
      }
    }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"萝卜纸巾猫情侣版｜但男友是那只猫",
    "url":"https://gamesurvivors.com/luobo-zhijin-couple",
    "applicationCategory":"GameApplication",
    "operatingSystem":"Web",
    "description":"《萝卜纸巾猫》情侣版上线~~快发给男友让他帮你选化妆品吧！3次机会，答对亲吻奖励，答错榴莲惩罚，看你能得芳心几许？"
  }
  </script>

  <style>
    .tap-scale { transform: translateZ(0); }
    .tap-scale:active { transform: scale(0.98); }
    .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
    .no-select { -webkit-user-select:none; user-select:none; }
  </style>
</head>

<body class="bg-appleBg text-appleText safe-pb">
  <header class="max-w-3xl mx-auto px-4 sm:px-6 pt-10 pb-6">
    <h1 class="text-2xl sm:text-4xl font-semibold tracking-tight">
      萝卜纸巾情侣版（暂定）：困难模式·只看图辨妆
    </h1>
    <p class="mt-3 text-appleSub leading-relaxed max-w-2xl">
      女朋友用很日常的说法提需求，你只能看两张化妆品图片做选择。答对亲吻奖励，答错榴莲惩罚，3题后红心结算默契值。
    </p>
  </header>

  <main class="max-w-3xl mx-auto px-4 sm:px-6 pb-12">
    <!-- ========== A) 初始页面 ========== -->
    <section id="viewHome" class="rounded-2xl bg-appleCard shadow-apple border border-appleGray p-5 sm:p-6">
      <h2 class="text-lg sm:text-xl font-semibold">开始前</h2>
      <p class="mt-2 text-appleSub leading-relaxed">
        先选难度，再开始。
      </p>

      <!-- 难度选择 -->
      <div class="mt-4 rounded-xl border border-appleGray bg-white p-4">
        <div class="text-sm text-appleSub">选择难度</div>
        <div class="mt-2 inline-flex rounded-xl border border-appleGray overflow-hidden">
          <button id="btnDiffEasy" class="px-4 py-2 text-sm font-medium bg-white hover:bg-appleBg transition">
            普通
          </button>
          <button id="btnDiffHard" class="px-4 py-2 text-sm font-medium bg-appleBg hover:bg-appleBg transition">
            困难
          </button>
        </div>
        </div>
      </div>

      <div class="mt-5 grid grid-cols-1 sm:grid-cols-3 gap-3">
        <button id="btnGoGame" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-3 bg-appleBlue text-white font-medium shadow-apple hover:opacity-95 transition">
          开始游戏
        </button>

        <button id="btnGoRules" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-3 bg-white border border-appleGray text-appleText font-medium hover:shadow-apple transition">
          查看细致规则
        </button>

        <button id="btnGoScore" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-3 bg-white border border-appleGray text-appleText font-medium hover:shadow-apple transition">
          最近积分
        </button>
      </div>

      <div class="mt-6 rounded-xl border border-appleGray bg-white p-4">
        </div>
      </div>
    </section>

    <!-- ========== 查看细致规则（单独页） ========== -->
    <section id="viewRules" class="hidden mt-6 rounded-2xl bg-appleCard shadow-apple border border-appleGray p-5 sm:p-6">
      <div class="flex items-start justify-between gap-3">
        <h2 class="text-lg sm:text-xl font-semibold">细致规则</h2>
        <button id="btnRulesBack" class="tap-scale rounded-xl px-3 py-2 bg-white border border-appleGray text-sm font-medium hover:shadow-apple transition">
          返回
        </button>
      </div>

      <ul class="mt-4 space-y-2 text-appleSub leading-relaxed">
        <li>你扮演男生：每题根据女朋友的需求提示，从两款相似化妆品中二选一。</li>
        <li>每局共 3 题；同一局内题目不重复。</li>
        <li>普通模式：提示更直白；仍然只看图作答（更贴近“困难”玩法一致性）。</li>
        <li>困难模式：提示更口语、更生活化；作答前不出现任何解析信息。</li>
        <li>作答后：立即显示“当前反馈”，公布正确答案，并展示两款产品的名称与专业解析（帮助玩家学习）。</li>
        <li>结算：以 1-3 颗红心代表答对题数（0题显示💔）。</li>
      </ul>
    </section>

    <!-- ========== 最近积分（单独页） ========== -->
    <section id="viewScore" class="hidden mt-6 rounded-2xl bg-appleCard shadow-apple border border-appleGray p-5 sm:p-6">
      <div class="flex items-start justify-between gap-3">
        <h2 class="text-lg sm:text-xl font-semibold">最近积分</h2>
        <button id="btnScoreBack" class="tap-scale rounded-xl px-3 py-2 bg-white border border-appleGray text-sm font-medium hover:shadow-apple transition">
          返回
        </button>
      </div>

      <p class="mt-3 text-appleSub leading-relaxed">
        本地记录最近 5 局（仅保存在你的浏览器中）。
      </p>

      <div class="mt-4 rounded-xl border border-appleGray bg-white p-4">
        <div class="flex items-center justify-between gap-3">
          <div class="text-sm text-appleSub">记录列表</div>
          <button id="btnClearHistory" class="tap-scale rounded-xl px-3 py-2 bg-white border border-appleGray text-sm font-medium hover:shadow-apple transition">
            清空记录
          </button>
        </div>

        <div id="historyList" class="mt-3 space-y-3"></div>
        <div id="historyEmpty" class="mt-3 text-sm text-appleSub hidden">暂无记录。先来一局吧。</div>
      </div>
    </section>

    <!-- ========== B) 游戏页：3道题 ========== -->
    <section id="viewGame" class="hidden mt-6 rounded-2xl bg-appleCard shadow-apple border border-appleGray p-5 sm:p-6">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <h2 class="text-lg sm:text-xl font-semibold">挑战进行中：第 <span id="roundNum">1</span> / 3 题</h2>
        <div class="flex items-center gap-2 text-sm text-appleSub">
          <span class="inline-flex items-center justify-center w-8 h-8 rounded-xl bg-white border border-appleGray" title="正确数">✓</span>
          <span id="scoreBadge" class="font-medium">0</span>
        </div>
      </div>

      <p id="prompt" class="mt-2 text-appleSub leading-relaxed">
        —
      </p>

      <!-- 选项：仅图片呈现 -->
      <div class="mt-5 grid grid-cols-1 sm:grid-cols-2 gap-4">
        <button id="optA" class="tap-scale no-select text-left rounded-2xl border border-appleGray bg-white p-4 hover:shadow-apple transition disabled:opacity-50 disabled:cursor-not-allowed">
          <div class="text-sm text-appleSub">选项 A</div>

          <div class="mt-3 rounded-xl border border-appleGray overflow-hidden bg-appleBg">
            <img id="imgA" src="" alt="" loading="eager" class="w-full aspect-square object-cover" />
          </div>

          <!-- 隐藏名称：仅给读屏/SEO（不帮助玩家视觉作答） -->
          <div id="srNameA" class="sr-only"></div>

          <!-- 方案B：作答前无解析节点；作答后动态插入解析 -->
        </button>

        <button id="optB" class="tap-scale no-select text-left rounded-2xl border border-appleGray bg-white p-4 hover:shadow-apple transition disabled:opacity-50 disabled:cursor-not-allowed">
          <div class="text-sm text-appleSub">选项 B</div>

          <div class="mt-3 rounded-xl border border-appleGray overflow-hidden bg-appleBg">
            <img id="imgB" src="" alt="" loading="eager" class="w-full aspect-square object-cover" />
          </div>

          <div id="srNameB" class="sr-only"></div>
        </button>
      </div>

      <!-- 作答后立即显示反馈 -->
      <div id="feedbackCard" class="hidden mt-5 rounded-xl border border-appleGray bg-white p-4">
        <div class="text-sm text-appleSub">当前反馈</div>
        <div id="feedback" class="mt-2 text-base font-semibold">-</div>
        <div id="rewardLine" class="mt-2 text-2xl" aria-live="polite"></div>

        <div class="mt-3 flex flex-wrap gap-3">
          <button id="btnNext" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-2 bg-appleGreen text-white font-medium shadow-apple hover:opacity-95 transition disabled:opacity-50 disabled:cursor-not-allowed">
            下一题
          </button>
          <button id="btnQuitToHome" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-2 bg-white border border-appleGray text-appleText font-medium hover:shadow-apple transition">
            退出到首页
          </button>
        </div>
      </div>
    </section>

    <!-- ========== C) 结算结果页 ========== -->
    <section id="viewResult" class="hidden mt-6 rounded-2xl bg-appleCard shadow-apple border border-appleGray p-5 sm:p-6">
      <h2 class="text-lg sm:text-xl font-semibold">结算结果</h2>
      <p class="mt-2 text-appleSub leading-relaxed">
        你本局答对 <span id="finalScoreInline" class="font-semibold text-appleText">0</span> 题，红心代表默契值。
      </p>

      <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="rounded-2xl border border-appleGray bg-white p-5">
          <div class="text-sm text-appleSub">红心</div>
          <div id="hearts" class="mt-2 text-3xl" aria-live="polite">—</div>
        </div>
        <div class="rounded-2xl border border-appleGray bg-white p-5">
          <div class="text-sm text-appleSub">正确题数</div>
          <div id="finalScore" class="mt-2 text-2xl font-semibold">—</div>
        </div>
        <div class="rounded-2xl border border-appleGray bg-white p-5">
          <div class="text-sm text-appleSub">评价</div>
          <div id="finalComment" class="mt-2 text-base font-semibold">—</div>
        </div>
      </div>

      <div class="mt-5 flex flex-wrap gap-3">
        <button id="btnPlayAgain" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-2 bg-appleBlue text-white font-medium shadow-apple hover:opacity-95 transition">
          再来一局
        </button>
        <button id="btnResultToHome" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-2 bg-white border border-appleGray text-appleText font-medium hover:shadow-apple transition">
          回到首页
        </button>
        <button id="btnResultToScore" class="tap-scale inline-flex items-center justify-center rounded-xl px-4 py-2 bg-white border border-appleGray text-appleText font-medium hover:shadow-apple transition">
          查看最近积分
        </button>
      </div>
    </section>

    <footer class="mt-10 text-center text-sm text-appleSub">
      <h2 class="sr-only">页脚</h2>
      <p>© <span id="year"></span> GameSurvivors.com · 萝卜纸巾情侣版（暂定）</p>
    </footer>
  </main>

  <script>
    // =============================
    // 难度
    // =============================
    const DIFF_KEY = "gs_luobo_zhijin_diff_v1"; // "easy" | "hard"
    function getDiff() {
      const v = localStorage.getItem(DIFF_KEY);
      return (v === "easy" || v === "hard") ? v : "hard";
    }
    function setDiff(v) {
      localStorage.setItem(DIFF_KEY, v);
      renderDiffUI();
    }

    // =============================
    // 图片路径（默认本地资源方案）
    // 你只要把图片按文件名放到 /assets/cosmetics/ 即可
    // =============================
    const ASSET_BASE = "/assets/cosmetics/";

    // =============================
    // 题库：promptHard 口语化；promptEasy 更直白
    // 解析（desc）允许更专业，但仅作答后显示
    // 每个选项必须提供 img（本地路径）
    // =============================
    const PAIRS = [
      {
        id: "lipstick-vs-lipbalm",
        promptEasy: "她说：『我想要上嘴有点颜色、看起来精神点的那个。』你选？",
        promptHard: "她说：『我现在嘴巴看着好没气色，你给我拿那个“上嘴立刻像没熬夜”的。』",
        a: { name: "润唇膏", img: ASSET_BASE + "lip-balm.webp", desc: "润唇膏以滋润修护为主，颜色通常更淡或无色，更偏护唇用途。" },
        b: { name: "口红", img: ASSET_BASE + "lipstick.webp", desc: "口红显色更强，强调妆效与气色提升，通常比润唇膏更“有妆感”。" },
        correct: "口红"
      },
      {
        id: "lipgloss-vs-lipoil",
        promptEasy: "她说：『我想要嘴巴亮亮的、像果冻那样的。』你选？",
        promptHard: "她说：『我要那种一抹就“水光嘟嘟”的，拍照会反光那种。』",
        a: { name: "唇蜜（Lip Gloss）", img: ASSET_BASE + "lip-gloss.webp", desc: "唇蜜更强调镜面光泽与成膜妆效，视觉存在感更强，常用于打造“玻璃唇”。" },
        b: { name: "唇油（Lip Oil）", img: ASSET_BASE + "lip-oil.webp", desc: "唇油更偏滋润养护与轻薄光泽，妆效通常更像“护唇+微光”。" },
        correct: "唇蜜（Lip Gloss）"
      },
      {
        id: "foundation-vs-bb",
        promptEasy: "她说：『今天要遮得更稳一点、妆看起来更认真。』你选？",
        promptHard: "她说：『我今天要见人，别让我脸看起来“没睡醒”，给我拿那个更能打的底。』",
        a: { name: "粉底液", img: ASSET_BASE + "foundation.webp", desc: "粉底液遮瑕/妆效可选范围更广，更适合打造完整、正式的底妆。" },
        b: { name: "BB霜", img: ASSET_BASE + "bb-cream.webp", desc: "BB霜更偏日常快速上脸，遮瑕通常更轻薄，妆效更“懒人友好”。" },
        correct: "粉底液"
      },
      {
        id: "concealer-vs-corrector",
        promptEasy: "她说：『黑眼圈有点重，我要能把它遮住的那支。』你选？",
        promptHard: "她说：『我这黑眼圈太明显了，快给我拿那个“能直接盖住”的，不要搞花里胡哨。』",
        a: { name: "遮瑕膏", img: ASSET_BASE + "concealer.webp", desc: "遮瑕膏用于遮盖黑眼圈、痘印等局部瑕疵，通常更高遮盖力。" },
        b: { name: "校色膏", img: ASSET_BASE + "color-corrector.webp", desc: "校色膏用于中和肤色问题（泛红/暗沉/青紫），更偏颜色修正而非直接遮盖。" },
        correct: "遮瑕膏"
      },
      {
        id: "blush-vs-contour",
        promptEasy: "她说：『我想脸颊看起来有点血色。』你选？",
        promptHard: "她说：『我想看起来更有精神一点，不要像刚下班那样“脸一片灰”。』",
        a: { name: "腮红", img: ASSET_BASE + "blush.webp", desc: "腮红用于增加红润气色，通常上在苹果肌或颧骨附近，立刻“有生命力”。" },
        b: { name: "修容（阴影）", img: ASSET_BASE + "contour.webp", desc: "修容用于加强轮廓与阴影，偏“瘦脸/立体”，不是增加气色的主力产品。" },
        correct: "腮红"
      },
      {
        id: "highlighter-vs-glow-primer",
        promptEasy: "她说：『我想鼻梁、颧骨那儿亮一点。』你选？",
        promptHard: "她说：『我想脸上有点“闪一下”的感觉，就那种拍照一转头会亮的。』",
        a: { name: "高光", img: ASSET_BASE + "highlighter.webp", desc: "高光用于局部提亮（颧骨/鼻梁/眉骨等），光泽集中，闪度更明显。" },
        b: { name: "妆前乳（珠光）", img: ASSET_BASE + "glow-primer.webp", desc: "珠光妆前乳更偏整体打底提亮、增加服帖度，光泽更均匀更克制。" },
        correct: "高光"
      },
      {
        id: "brow-pencil-vs-brow-powder",
        promptEasy: "她说：『我想眉毛画得更清楚一点。』你选？",
        promptHard: "她说：『我想眉毛更有“根根分明”的感觉，别糊成一片。』",
        a: { name: "眉笔", img: ASSET_BASE + "brow-pencil.webp", desc: "眉笔线条感更强，适合刻画眉形与细节，容易做出清晰眉尾和毛流。" },
        b: { name: "眉粉", img: ASSET_BASE + "brow-powder.webp", desc: "眉粉雾面柔和，适合大面积填色与自然过渡，但线条锐利度通常不如眉笔。" },
        correct: "眉笔"
      },
      {
        id: "eyeliner-pen-vs-eyeliner-gel",
        promptEasy: "她说：『我想要更不容易晕的眼线。』你选？",
        promptHard: "她说：『我眼线老是糊！给我拿那个更扛造的，我要今天一整天都别塌。』",
        a: { name: "眼线液笔", img: ASSET_BASE + "eyeliner-pen.webp", desc: "眼线液笔出线利落、锋利，适合拉长眼尾，但不同配方防晕能力差异大。" },
        b: { name: "眼线胶笔", img: ASSET_BASE + "eyeliner-gel.webp", desc: "眼线胶笔更贴合睫毛根部，很多人用于内眼线与更耐磨的线条需求。" },
        correct: "眼线胶笔"
      },
      {
        id: "setting-spray-vs-setting-powder",
        promptEasy: "她说：『我想马上控油、不要反光。』你选？",
        promptHard: "她说：『我现在脸好油，拍照要变“反光板”了，快给我按住它！』",
        a: { name: "定妆喷雾", img: ASSET_BASE + "setting-spray.webp", desc: "定妆喷雾更偏成膜与服帖度提升，控油与哑光效果取决于配方类型。" },
        b: { name: "定妆粉", img: ASSET_BASE + "setting-powder.webp", desc: "定妆粉能更直接压油光、柔焦毛孔，达到快速哑光与控油目的。" },
        correct: "定妆粉"
      },
      {
        id: "mascara-vs-lash-primer",
        promptEasy: "她说：『我想睫毛刷完更长更浓。』你选？",
        promptHard: "她说：『我想眼睛立刻有神！那种一刷就“眼神起来了”的拿来。』",
        a: { name: "睫毛膏", img: ASSET_BASE + "mascara.webp", desc: "睫毛膏主打纤长/浓密/卷翘，能直接带来明显妆效变化。" },
        b: { name: "睫毛打底", img: ASSET_BASE + "lash-primer.webp", desc: "睫毛打底用于增强后续睫毛膏表现，本身妆效通常更弱、更偏辅助。" },
        correct: "睫毛膏"
      }
    ];

    // =============================
    // 工具
    // =============================
    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

    // 预加载图片，减少切题闪烁
    function preloadImages(urls) {
      urls.forEach(u => {
        const im = new Image();
        im.src = u;
      });
    }

    // =============================
    // 本地“最近积分”存储
    // =============================
    const HISTORY_KEY = "gs_luobo_zhijin_couple_history_v1";
    function loadHistory() {
      try { return JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]"); }
      catch { return []; }
    }
    function saveHistory(list) {
      localStorage.setItem(HISTORY_KEY, JSON.stringify(list));
    }
    function pushHistory(entry) {
      const list = loadHistory();
      list.unshift(entry);
      saveHistory(list.slice(0, 5));
    }

    // =============================
    // 视图切换
    // =============================
    const viewHome   = document.getElementById("viewHome");
    const viewRules  = document.getElementById("viewRules");
    const viewScore  = document.getElementById("viewScore");
    const viewGame   = document.getElementById("viewGame");
    const viewResult = document.getElementById("viewResult");

    function showOnly(view) {
      [viewHome, viewRules, viewScore, viewGame, viewResult].forEach(v => v.classList.add("hidden"));
      view.classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // =============================
    // DOM：难度 UI
    // =============================
    const btnDiffEasy = document.getElementById("btnDiffEasy");
    const btnDiffHard = document.getElementById("btnDiffHard");
    const diffHint = document.getElementById("diffHint");

    function renderDiffUI() {
      const d = getDiff();
      // 简单做“选中态”
      if (d === "easy") {
        btnDiffEasy.classList.add("bg-appleBg");
        btnDiffHard.classList.remove("bg-appleBg");
        diffHint.textContent = "普通：提示更直白；选项仍只看图作答；解析在作答后给出。";
      } else {
        btnDiffHard.classList.add("bg-appleBg");
        btnDiffEasy.classList.remove("bg-appleBg");
        diffHint.textContent = "困难：选项仅图片呈现；提示更生活化；解析在作答后给出。";
      }
    }

    // =============================
    // DOM：游戏
    // =============================
    const roundNum = document.getElementById("roundNum");
    const scoreBadge = document.getElementById("scoreBadge");
    const promptEl = document.getElementById("prompt");

    const optA = document.getElementById("optA");
    const optB = document.getElementById("optB");

    const imgA = document.getElementById("imgA");
    const imgB = document.getElementById("imgB");

    const srNameA = document.getElementById("srNameA");
    const srNameB = document.getElementById("srNameB");

    const feedbackCard = document.getElementById("feedbackCard");
    const feedback = document.getElementById("feedback");
    const rewardLine = document.getElementById("rewardLine");
    const btnNext = document.getElementById("btnNext");

    // =============================
    // DOM：结算
    // =============================
    const heartsEl = document.getElementById("hearts");
    const finalScoreEl = document.getElementById("finalScore");
    const finalScoreInline = document.getElementById("finalScoreInline");
    const finalCommentEl = document.getElementById("finalComment");

    // =============================
    // DOM：最近积分
    // =============================
    const historyList = document.getElementById("historyList");
    const historyEmpty = document.getElementById("historyEmpty");

    // =============================
    // 状态
    // =============================
    let gameActive = false;
    let roundIndex = 0;
    let score = 0;
    let questions = [];
    let answered = false;
    let currentQ = null;
    let currentLayout = null; // {A:{name,img,desc}, B:{name,img,desc}, correctName}

    // =============================
    // 解析节点（方案B）：动态插入/移除
    // =============================
    function clearAnalysisNodes() {
      const aNode = optA.querySelector("[data-analysis='A']");
      const bNode = optB.querySelector("[data-analysis='B']");
      if (aNode) aNode.remove();
      if (bNode) bNode.remove();
    }

    function injectAnalysis(side, name, desc) {
      const host = (side === "A") ? optA : optB;

      const wrap = document.createElement("div");
      wrap.setAttribute("data-analysis", side);
      wrap.className = "mt-4 rounded-xl border border-appleGray bg-appleBg p-4";

      const title = document.createElement("div");
      title.className = "text-sm text-appleSub";
      title.textContent = "题目解析";

      const n = document.createElement("div");
      n.className = "mt-1 text-base font-semibold";
      n.textContent = name;

      const p = document.createElement("div");
      p.className = "mt-2 text-sm text-appleSub leading-relaxed";
      p.textContent = desc;

      wrap.appendChild(title);
      wrap.appendChild(n);
      wrap.appendChild(p);

      host.appendChild(wrap);
    }

    // =============================
    // UI：边框高亮
    // =============================
    function setOptionBorder(state) {
      [optA, optB].forEach(btn => {
        btn.classList.remove("border-appleGreen","border-appleRed","ring-2","ring-appleGreen","ring-appleRed");
        btn.classList.add("border-appleGray");
      });

      if (state === "correctA") {
        optA.classList.remove("border-appleGray");
        optA.classList.add("border-appleGreen","ring-2","ring-appleGreen");
      }
      if (state === "correctB") {
        optB.classList.remove("border-appleGray");
        optB.classList.add("border-appleGreen","ring-2","ring-appleGreen");
      }
      if (state === "wrongA") {
        optA.classList.remove("border-appleGray");
        optA.classList.add("border-appleRed","ring-2","ring-appleRed");
      }
      if (state === "wrongB") {
        optB.classList.remove("border-appleGray");
        optB.classList.add("border-appleRed","ring-2","ring-appleRed");
      }
    }

    function setChoicesEnabled(enabled) {
      optA.disabled = !enabled;
      optB.disabled = !enabled;
    }

    function updateHUD() {
      roundNum.textContent = String(roundIndex + 1);
      scoreBadge.textContent = String(score);
    }

    // =============================
    // 游戏：开始/出题/作答/结算
    // =============================
    function startGame() {
      questions = shuffle(PAIRS).slice(0, 3);
      roundIndex = 0;
      score = 0;
      answered = false;
      gameActive = true;

      feedbackCard.classList.add("hidden");
      rewardLine.textContent = "";
      setOptionBorder("neutral");
      clearAnalysisNodes();

      // 预加载本局图片
      const urls = [];
      questions.forEach(q => {
        urls.push(q.a.img, q.b.img);
      });
      preloadImages(urls);

      showOnly(viewGame);
      loadRound();
    }

    function loadRound() {
      currentQ = questions[roundIndex];
      answered = false;
      updateHUD();

      const d = getDiff();
      promptEl.textContent = (d === "hard") ? currentQ.promptHard : currentQ.promptEasy;

      // 洗牌摆放 A/B（作答前仅图片）
      const variants = shuffle([
        { name: currentQ.a.name, img: currentQ.a.img, desc: currentQ.a.desc },
        { name: currentQ.b.name, img: currentQ.b.img, desc: currentQ.b.desc }
      ]);

      currentLayout = {
        A: variants[0],
        B: variants[1],
        correctName: currentQ.correct
      };

      // 设置图片（作答时只显示图）
      imgA.src = currentLayout.A.img;
      imgB.src = currentLayout.B.img;

      // alt & sr-only：不影响视觉，但提升无障碍与可维护性
      imgA.alt = "化妆品选项A（图片）";
      imgB.alt = "化妆品选项B（图片）";
      srNameA.textContent = currentLayout.A.name;
      srNameB.textContent = currentLayout.B.name;

      // 关键：切题前移除上一题解析
      clearAnalysisNodes();

      feedbackCard.classList.add("hidden");
      btnNext.disabled = true;

      setChoicesEnabled(true);
      setOptionBorder("neutral");
    }

    function answer(choiceKey) {
      if (!gameActive || answered) return;
      answered = true;

      setChoicesEnabled(false);

      const chosenName = currentLayout[choiceKey].name;
      const correctName = currentLayout.correctName;

      const isCorrect = chosenName === correctName;

      // 作答后：插入解析（专业表述只出现在这里）
      clearAnalysisNodes();
      injectAnalysis("A", currentLayout.A.name, currentLayout.A.desc);
      injectAnalysis("B", currentLayout.B.name, currentLayout.B.desc);

      // 反馈模块立即显示
      feedbackCard.classList.remove("hidden");

      if (isCorrect) {
        score += 1;
        feedback.textContent = `答对了：她要的是「${correctName}」。`;
        rewardLine.textContent = "💋💋💋（亲吻奖励）";
        setOptionBorder(choiceKey === "A" ? "correctA" : "correctB");
      } else {
        feedback.textContent = `答错了：她要的是「${correctName}」，你给了「${chosenName}」。`;
        rewardLine.textContent = "🫣🍈（榴莲惩罚）";
        setOptionBorder(choiceKey === "A" ? "wrongA" : "wrongB");

        const correctKey = (currentLayout.A.name === correctName) ? "A" : "B";
        setTimeout(() => {
          setOptionBorder(correctKey === "A" ? "correctA" : "correctB");
        }, 250);
      }

      updateHUD();

      if (roundIndex === 2) {
        btnNext.textContent = "查看结算结果";
        btnNext.disabled = false;
      } else {
        btnNext.textContent = "下一题";
        btnNext.disabled = false;
      }
    }

    function nextStep() {
      if (!answered) return;

      if (roundIndex === 2) {
        endGame();
        return;
      }

      roundIndex += 1;
      loadRound();
    }

    function endGame() {
      gameActive = false;

      pushHistory({
        ts: Date.now(),
        score,
        total: 3,
        diff: getDiff()
      });

      renderResult();
      showOnly(viewResult);
    }

    function renderResult() {
      const s = clamp(score, 0, 3);
      const hearts = s === 0 ? "💔" : "❤️".repeat(s);

      heartsEl.textContent = hearts;
      finalScoreInline.textContent = String(s);
      finalScoreEl.textContent = `${s} / 3`;

      let comment = "需要加强学习：建议先记住她常用的那几样。";
      if (s === 1) comment = "勉强过关：下一次，别让榴莲太嚣张。";
      if (s === 2) comment = "不错：已经接近“心有灵犀”。";
      if (s === 3) comment = "满分默契：今晚你是“懂妆王”。";
      finalCommentEl.textContent = comment;
    }

    // =============================
    // 最近积分：渲染
    // =============================
    function formatTime(ts) {
      const d = new Date(ts);
      const pad = (n) => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    function renderHistory() {
      const list = loadHistory();
      historyList.innerHTML = "";

      if (!list.length) {
        historyEmpty.classList.remove("hidden");
        return;
      }
      historyEmpty.classList.add("hidden");

      list.forEach(item => {
        const s = clamp(item.score, 0, 3);
        const hearts = s === 0 ? "💔" : "❤️".repeat(s);
        const diffText = item.diff === "easy" ? "普通" : "困难";

        const card = document.createElement("div");
        card.className = "rounded-xl border border-appleGray bg-appleBg p-4";
        card.innerHTML = `
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="text-sm text-appleSub">时间</div>
              <div class="mt-1 font-medium">${formatTime(item.ts)}</div>
              <div class="mt-1 text-sm text-appleSub">难度：${diffText}</div>
            </div>
            <div class="text-right">
              <div class="text-sm text-appleSub">成绩</div>
              <div class="mt-1 text-lg font-semibold">${s}/3</div>
            </div>
          </div>
          <div class="mt-2 text-2xl">${hearts}</div>
        `;
        historyList.appendChild(card);
      });
    }

    // =============================
    // 事件绑定
    // =============================
    document.getElementById("year").textContent = new Date().getFullYear();

    // 难度按钮
    btnDiffEasy.addEventListener("click", () => setDiff("easy"));
    btnDiffHard.addEventListener("click", () => setDiff("hard"));

    // 首页三按钮
    document.getElementById("btnGoGame").addEventListener("click", startGame);
    document.getElementById("btnGoRules").addEventListener("click", () => showOnly(viewRules));
    document.getElementById("btnGoScore").addEventListener("click", () => { renderHistory(); showOnly(viewScore); });

    // 规则页返回
    document.getElementById("btnRulesBack").addEventListener("click", () => showOnly(viewHome));

    // 积分页返回 + 清空
    document.getElementById("btnScoreBack").addEventListener("click", () => showOnly(viewHome));
    document.getElementById("btnClearHistory").addEventListener("click", () => {
      localStorage.removeItem(HISTORY_KEY);
      renderHistory();
    });

    // 游戏页：作答 / 下一步 / 退出
    optA.addEventListener("click", () => answer("A"));
    optB.addEventListener("click", () => answer("B"));
    btnNext.addEventListener("click", nextStep);
    document.getElementById("btnQuitToHome").addEventListener("click", () => showOnly(viewHome));

    // 结算页：再来一局 / 回首页 / 看积分
    document.getElementById("btnPlayAgain").addEventListener("click", startGame);
    document.getElementById("btnResultToHome").addEventListener("click", () => showOnly(viewHome));
    document.getElementById("btnResultToScore").addEventListener("click", () => { renderHistory(); showOnly(viewScore); });

    // 初始：渲染难度 + 首页
    renderDiffUI();
    showOnly(viewHome);
  </script>
</body>
</html>
